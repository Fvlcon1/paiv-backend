nohup: ignoring input
INFO:     Uvicorn running on http://0.0.0.0:4000 (Press CTRL+C to quit)
INFO:     Started parent process [120443]
/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:118: UserWarning: Specified provider 'CUDAExecutionProvider' is not in available provider names.Available providers: 'AzureExecutionProvider, CPUExecutionProvider'
  warnings.warn(
/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:118: UserWarning: Specified provider 'CUDAExecutionProvider' is not in available provider names.Available providers: 'AzureExecutionProvider, CPUExecutionProvider'
  warnings.warn(
/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:118: UserWarning: Specified provider 'CUDAExecutionProvider' is not in available provider names.Available providers: 'AzureExecutionProvider, CPUExecutionProvider'
  warnings.warn(
/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/onnxruntime/capi/onnxruntime_inference_collection.py:118: UserWarning: Specified provider 'CUDAExecutionProvider' is not in available provider names.Available providers: 'AzureExecutionProvider, CPUExecutionProvider'
  warnings.warn(
INFO:     Started server process [120448]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [120446]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [120445]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Started server process [120447]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO:     100.64.0.27:48722 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:48722 - "POST /login HTTP/1.1" 500 Internal Server Error
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO:     100.64.0.27:39958 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdWViaXJkMjNzem5AZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzMzc3MTB9.WuZ35V5Al14UcnrOsYUbpxJKgqgaztjsl7209hElikw
INFO:     100.64.0.27:39958 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:39958 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:47292 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:47292 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '46092ebb-4782-47fe-ad85-7f6ec7e460fe'}
INFO:     100.64.0.25:47292 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:57260 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:57260 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:57260 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:57260 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:38914 - "OPTIONS /autocomplete/memberships?query=Chris HTTP/1.1" 200 OK
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO:     100.64.0.25:38910 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:38914 - "GET /autocomplete/memberships?query=Chris HTTP/1.1" 200 OK
INFO:     100.64.0.25:57260 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH003, token: d5338ecd-5a97-4ae6-a002-d28d35df633a
INFO:     100.64.0.26:60486 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "OPTIONS /api/encounter/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "GET /api/encounter/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "OPTIONS /api/encounter/members/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 200 OK
INFO:     100.64.0.26:60486 - "GET /api/encounter/members/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 200 OK
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/1k3d68.onnx landmark_3d_68 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/2d106det.onnx landmark_2d_106 ['None', 3, 192, 192] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/det_10g.onnx detection [1, 3, '?', '?'] 127.5 128.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/genderage.onnx genderage ['None', 3, 96, 96] 0.0 1.0
Applied providers: ['CPUExecutionProvider'], with options: {'CPUExecutionProvider': {}}
find model: /root/.insightface/models/buffalo_l/w600k_r50.onnx recognition ['None', 3, 112, 112] 127.5 127.5
set det-size: (640, 640)
INFO:     100.64.0.27:46288 - "OPTIONS /api/compare HTTP/1.1" 200 OK
ERROR:api:Error in face comparison: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id 
FROM users 
WHERE users.email = %(email_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 849, in compare_images
    user_id = db.query(User.id).filter(User.email == user_email).scalar()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2831, in scalar
    ret = self.one()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2804, in one
    return self._iter().one()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id 
FROM users 
WHERE users.email = %(email_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com'}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:46288 - "POST /api/compare HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.26:41362 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.25:52844 - "OPTIONS /api/dispositions HTTP/1.1" 200 OK
INFO:     100.64.0.25:52844 - "GET /api/dispositions HTTP/1.1" 200 OK
INFO:     100.64.0.26:55542 - "OPTIONS /api/encounter HTTP/1.1" 200 OK
INFO:     100.64.0.26:55542 - "POST /api/encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:50598 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:50598 - "POST /login HTTP/1.1" 500 Internal Server Error
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:56758 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzNzcyODl9.YrKbCYO5G8O50yKDzuqNd4Qs7OagvqYBQUftKHRnRc4
INFO:     100.64.0.26:56758 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:56758 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:54268 - "GET /check-mfa HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:56758 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.27:54284 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.27:54284 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:42954 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'aef85b3e-c131-4cf0-9600-88cb24a71545'}
INFO:     100.64.0.27:54284 - "POST /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '02b9b7c8-4044-4d79-9936-ac17cd9fc576'}
INFO:     100.64.0.27:42954 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:41688 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:41688 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:41688 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:41700 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:41708 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:41710 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:41688 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:41700 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:41710 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:41708 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:35558 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:35566 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:35578 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.25:35578 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.25:35578 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.25:35578 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.27:53552 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 21996de8-8592-49a9-8f75-fa4f05f122da
INFO:     100.64.0.27:50516 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:50520 - "OPTIONS /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50530 - "OPTIONS /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50516 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:50534 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50546 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:50546 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50546 - "OPTIONS /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50534 - "OPTIONS /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50534 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:50534 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:50228 - "OPTIONS /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.27:41094 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.27:41522 - "OPTIONS /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:41520 - "OPTIONS /user/profile HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:41520 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.27:41520 - "GET /user/profile HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:37604 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:37602 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:34290 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:34304 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:55802 - "OPTIONS /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:55792 - "OPTIONS /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:55802 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:39158 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:50980 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:51076 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     100.64.0.25:50242 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:50236 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
ERROR:api:Error retrieving related verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1045, in get_related_verifications
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:50236 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:50236 - "GET /api/encounter/members/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:33004 - "OPTIONS /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.26:33004 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.26:33012 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:33012 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:33016 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:48930 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 500 Internal Server Error
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:48936 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:43026 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:43018 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.25:43028 - "GET /docs HTTP/1.1" 200 OK
INFO:     100.64.0.25:43028 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     100.64.0.26:52398 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:52396 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.26:34274 - "OPTIONS /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.26:34278 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:50418 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:50424 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:38272 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
INFO:     100.64.0.27:38268 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:41656 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:41654 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:59946 - "GET /api/encounter/21996de8-8592-49a9-8f75-fa4f05f122da HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:59932 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:42636 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:42628 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:42640 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:42654 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:42628 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:42636 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:42636 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:42628 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:58284 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:58284 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzODEyODh9.8IG-PGX3Lc0GkJ7yvOhYFBODFVaWXb2G_1OeN6EzTpM
INFO:     100.64.0.27:58288 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:42266 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:42256 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:42256 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:42266 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:42256 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:42266 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'ab7823af-d300-4c79-8d65-4083ea93e8bf'}
INFO:     100.64.0.26:42256 - "POST /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'a8389969-b831-44d5-98f1-de54ac26760f'}
INFO:     100.64.0.26:42266 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:59634 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:59634 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:59634 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:59650 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:59634 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:59650 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47854 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.25:47854 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.25:47854 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.25:47854 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.26:41212 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 7c464c91-c8b8-4ed4-9217-3e9b3538e209
INFO:     100.64.0.25:47588 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.25:47592 - "OPTIONS /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47612 - "OPTIONS /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47596 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:47592 - "GET /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47612 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:45552 - "GET /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:39146 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:39140 - "GET /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:39140 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.25:39146 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:39140 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:49568 - "GET /api/encounter/7c464c91-c8b8-4ed4-9217-3e9b3538e209 HTTP/1.1" 200 OK
INFO:     100.64.0.25:39146 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:39140 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:60130 - "GET /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.25:60150 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: b5b89e82-4a80-4ad2-890d-30046d2a7f6d
INFO:     100.64.0.27:60782 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:60782 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:60782 - "OPTIONS /api/encounter/b5b89e82-4a80-4ad2-890d-30046d2a7f6d HTTP/1.1" 200 OK
INFO:     100.64.0.27:60792 - "OPTIONS /api/encounter/b5b89e82-4a80-4ad2-890d-30046d2a7f6d HTTP/1.1" 200 OK
INFO:     100.64.0.27:60782 - "GET /api/encounter/b5b89e82-4a80-4ad2-890d-30046d2a7f6d HTTP/1.1" 200 OK
INFO:     100.64.0.27:60792 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:60792 - "GET /api/encounter/b5b89e82-4a80-4ad2-890d-30046d2a7f6d HTTP/1.1" 200 OK
INFO:     100.64.0.27:46300 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:46312 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:49162 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 7795b148-4ea6-41cb-84d4-07e2eafbd6bc
INFO:     100.64.0.26:49168 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:33728 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33740 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33734 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:33728 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33728 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33740 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33744 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:33740 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33740 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33740 - "OPTIONS /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33762 - "OPTIONS /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33756 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33762 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:33762 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:37364 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:37364 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:37364 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:37380 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:37380 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:39924 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:39926 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:39926 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:39924 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:39924 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.25:51980 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:51982 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.25:39504 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:39500 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.25:39510 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:44378 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:55578 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:55582 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.25:41768 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:41756 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.25:41742 - "OPTIONS /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:41756 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:41742 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:41756 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:47624 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:47610 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:47624 - "OPTIONS /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:47610 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:47610 - "OPTIONS /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.26:47610 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
INFO:     100.64.0.27:53898 - "GET /api/encounter/members/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:36082 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 500 Internal Server Error
ERROR:api:Error retrieving verification data: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1006, in get_verification_by_token
    user_email = decoded_data.get("email")
AttributeError: 'NoneType' object has no attribute 'get'
INFO:     100.64.0.25:55746 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:55758 - "GET /user/profile HTTP/1.1" 401 Unauthorized
ERROR:api:Error retrieving verification data: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1006, in get_verification_by_token
    user_email = decoded_data.get("email")
AttributeError: 'NoneType' object has no attribute 'get'
INFO:     100.64.0.25:55758 - "GET /api/encounter/7795b148-4ea6-41cb-84d4-07e2eafbd6bc HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:48102 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzODUwMTZ9.243HKtAi3HHYqwoHnZP3Sk7I6C6CVP5sCB1feHlrcHc
INFO:     100.64.0.26:44506 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:51942 - "GET /docs HTTP/1.1" 200 OK
INFO:     100.64.0.27:51942 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     100.64.0.25:45698 - "GET /docs HTTP/1.1" 200 OK
INFO:     100.64.0.25:55092 - "GET /docs HTTP/1.1" 200 OK
INFO:     100.64.0.25:55092 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     100.64.0.27:60066 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:60066 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzODc5MDV9.TkBERl3Lq9B5hzBsqMhGM9fZwksSpKaXGMSbm4LY8MY
INFO:     100.64.0.27:46428 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:59436 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:59432 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:59432 - "GET /check-mfa HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:59436 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:59436 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:59436 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:45886 - "OPTIONS /send-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:45886 - "POST /send-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:sendd:Email sent successfully: {'id': '0361b6bf-41fd-4dd0-a9cf-325b1cae3b5e'}
INFO:     100.64.0.26:59436 - "POST /send-otp HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzODc5NDB9.eCNmPVJ6Ftxm3JQzACn9kP0U6mw2ptIT_2OD-qOnfPU
INFO:     100.64.0.26:48538 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:48538 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:48538 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'b68ca706-31b1-4eab-bd2d-481dcfa294f6'}
INFO:     100.64.0.26:48538 - "POST /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '4d6c29f8-83d7-47d4-9a4e-41c7a072763c'}
INFO:     100.64.0.26:37948 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:49266 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:49266 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:49266 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:38840 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:49266 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:38850 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:38840 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:38850 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:38840 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:49266 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:35728 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.27:35728 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.27:35728 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.27:35728 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.26:58496 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 94ff4d17-d4af-4a4b-90f8-850423cece49
INFO:     100.64.0.26:58496 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.26:58500 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:58508 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:58520 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:58508 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:58520 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46644 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:46658 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46658 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46658 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:48822 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:48812 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46658 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:48812 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46658 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:45800 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:45800 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:45808 - "OPTIONS /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.26:56426 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.27:58570 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:37242 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:37244 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:37244 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:40108 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:40092 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:40108 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:40108 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:40108 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33922 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:33916 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33916 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33922 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33922 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:44400 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:44406 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:44406 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:44406 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:44406 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:36084 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:36094 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:36094 - "OPTIONS /user/profile HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:36094 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 500 Internal Server Error
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:36084 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:36094 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:36094 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:36096 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
ERROR:api:Error retrieving related verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1045, in get_related_verifications
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:54306 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.27:54306 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55160 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55160 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55160 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55172 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55160 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:55160 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:53650 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:53660 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:53660 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:53650 - "GET /user/profile HTTP/1.1" 200 OK
ERROR:api:Error retrieving related verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1045, in get_related_verifications
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:53650 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:53650 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:44350 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.27:44342 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:44350 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:44350 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:44350 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:38952 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:38938 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:38938 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.27:40124 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:40124 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:40124 - "OPTIONS /api/encounter/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1006, in get_verification_by_token
    user_email = decoded_data.get("email")
AttributeError: 'NoneType' object has no attribute 'get'
INFO:     100.64.0.27:40124 - "GET /api/encounter/d5338ecd-5a97-4ae6-a002-d28d35df633a HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:47928 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:47924 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47924 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47924 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:47924 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:51234 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:51222 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:51238 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:51248 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:51248 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:51248 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:51248 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:56204 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:56214 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:56230 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:56230 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:56230 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:37344 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:37350 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:37350 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:37350 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:37350 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:32916 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:32930 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:32930 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:32930 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:32930 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:47894 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:47896 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:47896 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:47896 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:47896 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:51996 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:52008 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:52008 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:52008 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:52008 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41606 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41606 - "OPTIONS /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:41624 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41606 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "OPTIONS /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:41612 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42182 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:42170 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42170 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42170 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42170 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33314 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:33304 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33304 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33304 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.27:33304 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:42534 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.26:42538 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42508 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:42500 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:42500 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:41500 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:41486 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:41486 - "GET /api/encounter/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:41486 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.25:41486 - "GET /api/encounter/members/94ff4d17-d4af-4a4b-90f8-850423cece49 HTTP/1.1" 200 OK
INFO:     100.64.0.32:49042 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:49036 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:49036 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:49042 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:37310 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.33:37310 - "POST /login HTTP/1.1" 500 Internal Server Error
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.35:58674 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTI1NTl9.29fc6h8TZ4QaPIDP5KVwm6xvgAVPlId_gXebvm7ImWc
INFO:     100.64.0.35:58674 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.32:40164 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.32:40164 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.32:40164 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'b17e60b7-b398-41ff-b11f-ce4b519f07ea'}
INFO:     100.64.0.32:40164 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.33:44944 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.33:44944 - "POST /verify-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.33:50970 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.33:50970 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:50974 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTI2MTB9.fTLuiBzDQ1HKQCr8lOFp_hs24uGttX2VP3ArCreYuxo
INFO:     100.64.0.24:57110 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:57110 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'f711aa15-ba7e-4f47-9230-8935d367fa12'}
INFO:     100.64.0.24:57110 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:43936 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:43936 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:43950 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTI2Mzd9.YndB2EZCIFpNzdajIzvyLXHALmw1zDZEAIIEmZg56Zc
INFO:     100.64.0.24:33266 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:33266 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '472983df-41c9-4873-8179-747c15b567c9'}
INFO:     100.64.0.24:33266 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:40438 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:45528 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:40438 - "GET /user/profile HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTI3NTh9.e_xhAr3FaVaio9_npkQoYLXRoL1hNa4LTv3zUG-srHY
INFO:     100.64.0.24:47902 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:47902 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '35cddf26-f7ae-4367-887d-c0dc44bca037'}
INFO:     100.64.0.24:47902 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:46624 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:46624 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.24:33756 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.20:37464 - "GET / HTTP/1.1" 404 Not Found
INFO:     100.64.0.23:50604 - "GET / HTTP/1.1" 404 Not Found
INFO:     100.64.0.28:41644 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.28:41642 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.28:41620 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.28:41634 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.24:40224 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.24:40224 - "POST /login HTTP/1.1" 500 Internal Server Error
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.35:41888 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTMyMTB9.ZSBM5-TW_ZHaUapYVxWtMwF_i2cOuZCH9Rl0-iGHls4
INFO:     100.64.0.35:55288 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.35:55288 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.35:55288 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.35:55288 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '3be09de9-05cc-4945-8301-f7dfcbb08917'}
INFO:     100.64.0.35:55288 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:56468 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.32:56468 - "POST /verify-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:sendd:Email sent successfully: {'id': '81b75809-686d-4e71-8f1b-6f7f98e1eff3'}
INFO:     100.64.0.32:55952 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:44238 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.35:60112 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:40378 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:40380 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:40378 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:40380 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM0MDZ9.CRPrzmHnQvhQ0fFiSbM9Zw3X-w8lYXE3VYPiuiSS-bw
INFO:     100.64.0.24:50816 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:50816 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'df7dcbb2-d573-485a-b639-82240a75b86c'}
INFO:     100.64.0.24:50816 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:42702 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:49890 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:49882 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:49882 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:49890 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:34878 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM0NzJ9.c3aoEvP-osMjxFd8Kv5VFhOeho_IeA48gNnRUCSJYT4
INFO:     100.64.0.25:34878 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.25:34886 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:34886 - "GET /check-mfa HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:36386 - "OPTIONS /enable-email-2fa HTTP/1.1" 200 OK
INFO:     100.64.0.26:36386 - "POST /enable-email-2fa HTTP/1.1" 400 Bad Request
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM1MDZ9.kGjnTjabQaZCqozLTPK2Yub8FKybE4r0c8N7sVkGQ1A
INFO:     100.64.0.25:53720 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.25:53720 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:53720 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '8bfd5141-aed3-45c1-9035-cb20993f0273'}
INFO:     100.64.0.25:53720 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:48608 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '8fad553d-d7d5-43d8-ae66-ee0ec02cce8c'}
INFO:     100.64.0.26:48608 - "POST /send-otp HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM1Nzd9._YnbJxgDeoHkL1amKN-jVyvk7eLKgw86ZxA7XieXL4k
INFO:     100.64.0.27:34770 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:34770 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'eddce804-f421-4f67-a3be-69a4be987014'}
INFO:     100.64.0.27:34770 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:47972 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:47982 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:34302 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM2NDV9.aLeiJUM_zP3EULi6k6pL4bW-GgLuOpr2xJ2A9kao9Nk
INFO:     100.64.0.26:34302 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:34318 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:34318 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:34318 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:34318 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:34318 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:34328 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '0e9fba0d-6303-4130-a8ea-4bf2cfe3d9e1'}
INFO:     100.64.0.26:34318 - "POST /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '5fd0b59e-6728-42b0-b8ce-778a4d945a56'}
INFO:     100.64.0.26:34328 - "POST /send-otp HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM2NzF9.eyQHosnxWRB3J5Q_Hm47gCeG1nflcyuvqYhcVgQ-yLI
INFO:     100.64.0.32:45548 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.32:45548 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'b29838c8-4852-4d7f-8aa8-3cd151e13d81'}
INFO:     100.64.0.32:45548 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:55934 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:55934 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:55936 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:55942 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:55950 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:55946 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:55936 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:55942 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:55950 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:55950 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:41904 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM3MTN9.qIx992pzVLHlcWjm-GC6SIRxsPK30kytdvDcBJI3rAI
INFO:     100.64.0.27:36420 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:36420 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '62e28d9e-7602-4f85-9a6a-f997f03e5687'}
INFO:     100.64.0.27:36420 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:41516 - "OPTIONS /2fa/setup HTTP/1.1" 200 OK
INFO:     100.64.0.24:41516 - "POST /2fa/setup HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:41346 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:41346 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:52682 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:41980 - "GET /my_verifications?limit=15 HTTP/1.1" 403 Forbidden
INFO:     100.64.0.26:41976 - "GET /user/profile HTTP/1.1" 403 Forbidden
INFO:     100.64.0.26:44326 - "GET /user/profile HTTP/1.1" 403 Forbidden
INFO:     100.64.0.26:44332 - "GET /my_verifications?limit=15 HTTP/1.1" 403 Forbidden
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTM4MDJ9.wVhcgJQaXqLokBX1eFkdv9oeZjivRJwvU58v7l7SifE
INFO:     100.64.0.27:32776 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:32776 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '9145d5d3-103e-4189-9db6-95c5f086344c'}
INFO:     100.64.0.27:32776 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:46462 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:46462 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:46468 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:43464 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.26:43464 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.26:43464 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.26:43464 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.26:53980 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 10860c7e-29f8-4aa9-b636-fb6fd31e5724
INFO:     100.64.0.26:53980 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.26:53994 - "OPTIONS /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.26:53986 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:53986 - "OPTIONS /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.26:53994 - "GET /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.26:53994 - "GET /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.25:38750 - "OPTIONS /api/encounter/members/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.25:38750 - "GET /api/encounter/members/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 200 OK
INFO:     100.64.0.27:50776 - "GET /user/profile HTTP/1.1" 401 Unauthorized
ERROR:api:Error retrieving verification data: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1006, in get_verification_by_token
    user_email = decoded_data.get("email")
AttributeError: 'NoneType' object has no attribute 'get'
INFO:     100.64.0.27:50776 - "GET /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 500 Internal Server Error
ERROR:api:Error retrieving verification data: 'NoneType' object has no attribute 'get'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1006, in get_verification_by_token
    user_email = decoded_data.get("email")
AttributeError: 'NoneType' object has no attribute 'get'
INFO:     100.64.0.27:50776 - "GET /api/encounter/10860c7e-29f8-4aa9-b636-fb6fd31e5724 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.27:42146 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:42146 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:41248 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:41248 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:33794 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:33804 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.24:37460 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTQxNDB9.5NyUw3XhVzzNjMZVGkAPPdYv-kifQ27TkhgbC8Cd7Bg
INFO:     100.64.0.24:37460 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:37460 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.24:37460 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.24:37460 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '773d612c-83ef-4bf3-9d7a-f8f2f0bbfcb7'}
INFO:     100.64.0.24:37460 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.33:46734 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.33:46734 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:37086 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'bb0b4682-55ad-49e1-b68a-200ed359bbf8'}
INFO:     100.64.0.33:37086 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.35:35410 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:44296 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:44304 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.33:44304 - "GET /my_verifications?limit=15 HTTP/1.1" 403 Forbidden
INFO:     100.64.0.33:44296 - "GET /user/profile HTTP/1.1" 403 Forbidden
INFO:     100.64.0.32:37316 - "OPTIONS /verified_encounters?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:37326 - "GET /user/profile HTTP/1.1" 403 Forbidden
INFO:     100.64.0.32:37316 - "GET /verified_encounters?limit=15 HTTP/1.1" 403 Forbidden
INFO:     100.64.0.25:55284 - "GET /docs HTTP/1.1" 200 OK
INFO:     100.64.0.25:55284 - "GET /openapi.json HTTP/1.1" 200 OK
INFO:     100.64.0.25:55284 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:55284 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTU1MTd9.aIe0Q9l-p97FSg8822JzJ37vQ5RPEYP5PVAQE-PYyL8
INFO:     100.64.0.26:55454 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:55468 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:55468 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:56616 - "GET /check-mfa HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.27:52390 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:     100.64.0.25:56620 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:56620 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTU1MjN9.GkOuyHhqjSw7ZQB2rUuvpq7n_wWmH6fxV2fXGmfEqvs
INFO:     100.64.0.27:52390 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.25:56620 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:56628 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:52390 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.27:52390 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '04349bb6-f73a-42fd-8877-c5be0624cdd4'}
INFO:     100.64.0.25:56620 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:59884 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '4ea78ffb-3f4b-476f-9e0f-06cf2c5941fd'}
INFO:     100.64.0.25:56628 - "POST /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '6680a0a9-8963-4df3-a12e-f06aa2b7e243'}
INFO:     100.64.0.26:59884 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:35224 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:35224 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.26:35224 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:35240 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:35224 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:35224 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:58146 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.27:58146 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.27:58146 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.27:58146 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 36b5fcf1-2796-4193-9ad4-b8cbdd2fd102
INFO:     100.64.0.27:57232 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "OPTIONS /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:57238 - "OPTIONS /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:57238 - "GET /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "GET /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "OPTIONS /api/encounter/members/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:57232 - "GET /api/encounter/members/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.35:60596 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.35:60604 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.35:60604 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.35:60596 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:35940 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.32:35940 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTYzNzl9.8ubf0pv1lh9n6G-lTWVdLyO3MZLjAG9b91Vh81fIgMU
INFO:     100.64.0.33:42000 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.33:42000 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.33:42000 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.33:42000 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '03e3dda7-db41-41c9-aa6d-9748edd19b8f'}
INFO:     100.64.0.33:42000 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:48500 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.32:48500 - "POST /verify-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.33:51076 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.33:51076 - "GET /check-mfa HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:51090 - "OPTIONS /enable-email-2fa HTTP/1.1" 200 OK
INFO:     100.64.0.33:51090 - "POST /enable-email-2fa HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:57360 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:57364 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:57364 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:57360 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.27:42680 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdWViaXJkMjNzem5AZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTc5NzF9.jGRCke1QCUshbmb-kDX0NGyGpjM4HDziYsLQwsXYXSY
INFO:     100.64.0.27:42680 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.27:42680 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.27:42680 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:52954 - "OPTIONS /send-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:52954 - "POST /send-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'bluebird23szn@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.33:54898 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:54882 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.33:54898 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:54882 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.24:41582 - "OPTIONS /login HTTP/1.1" 200 OK
ERROR:api:Error during login: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.24:41582 - "POST /login HTTP/1.1" 500 Internal Server Error
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTc5OTF9.ba9grFtQ7CL02LqUDQCXYo_tGuyfXVenlK_ckcrRF1U
INFO:     100.64.0.24:41586 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.33:37484 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.33:37484 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.33:37484 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '5c4cc1b3-0a12-4458-aef5-dbd5bfd7fc99'}
INFO:     100.64.0.33:37484 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.24:39726 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.24:39726 - "POST /verify-otp HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 147, in get_temp_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.32:45364 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:45364 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.32:45374 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.24:51274 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.35:58210 - "OPTIONS /verified_encounters?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.35:58226 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.35:58210 - "GET /verified_encounters?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.24:57610 - "OPTIONS /autocomplete/memberships?query=mawuli HTTP/1.1" 200 OK
INFO:     100.64.0.24:57590 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.24:57602 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.24:57610 - "GET /autocomplete/memberships?query=mawuli HTTP/1.1" 200 OK
INFO:     100.64.0.24:57626 - "OPTIONS /autocomplete/memberships?query=m HTTP/1.1" 200 OK
INFO:     100.64.0.24:57636 - "OPTIONS /autocomplete/memberships?query=ma HTTP/1.1" 200 OK
INFO:     100.64.0.24:57636 - "OPTIONS /autocomplete/memberships?query=maw HTTP/1.1" 200 OK
INFO:     100.64.0.32:38786 - "GET /autocomplete/memberships?query=maw HTTP/1.1" 200 OK
INFO:     100.64.0.32:37884 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH002, token: 45c73700-b6e6-4594-a91c-293cf2201a81
INFO:     100.64.0.32:37884 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.32:50150 - "OPTIONS /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:50154 - "OPTIONS /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:37884 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:50154 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:50150 - "OPTIONS /api/encounter/members/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:37884 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:50150 - "GET /api/encounter/members/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.24:36290 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.24:36300 - "OPTIONS /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.24:36300 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.33:59720 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.24:49736 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.24:49748 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.32:58904 - "GET /api/encounter/45c73700-b6e6-4594-a91c-293cf2201a81 HTTP/1.1" 200 OK
INFO:     100.64.0.32:58914 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:58922 - "GET /autocomplete/memberships?query=maw HTTP/1.1" 200 OK
INFO:     100.64.0.32:58930 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.25:43660 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.25:43662 - "OPTIONS /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:36162 - "GET /user/profile HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.25:36154 - "GET /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 500 Internal Server Error
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.26:55460 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:55476 - "GET /api/encounter/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.26:55476 - "OPTIONS /api/encounter/members/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.26:55476 - "GET /api/encounter/members/36b5fcf1-2796-4193-9ad4-b8cbdd2fd102 HTTP/1.1" 200 OK
INFO:     100.64.0.27:40584 - "OPTIONS /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.27:40598 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.26:48892 - "OPTIONS /api/dispositions HTTP/1.1" 200 OK
INFO:     100.64.0.26:48892 - "GET /api/dispositions HTTP/1.1" 200 OK
INFO:     100.64.0.26:37640 - "OPTIONS /api/encounter HTTP/1.1" 200 OK
INFO:     100.64.0.26:37640 - "POST /api/encounter HTTP/1.1" 200 OK
INFO:     100.64.0.33:44002 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:44014 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.33:44002 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:44014 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.24:53676 - "OPTIONS /autocomplete/memberships?query=m HTTP/1.1" 200 OK
INFO:     100.64.0.24:53686 - "OPTIONS /autocomplete/memberships?query=ma HTTP/1.1" 200 OK
INFO:     100.64.0.24:53686 - "GET /autocomplete/memberships?query=ma HTTP/1.1" 200 OK
INFO:     100.64.0.32:59382 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH002, token: 6472594c-f3f3-47fc-8423-8d81e1028785
INFO:     100.64.0.32:59382 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.32:59382 - "OPTIONS /api/encounter/6472594c-f3f3-47fc-8423-8d81e1028785 HTTP/1.1" 200 OK
INFO:     100.64.0.32:59382 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:59398 - "GET /api/encounter/6472594c-f3f3-47fc-8423-8d81e1028785 HTTP/1.1" 200 OK
INFO:     100.64.0.32:59398 - "OPTIONS /api/encounter/members/6472594c-f3f3-47fc-8423-8d81e1028785 HTTP/1.1" 200 OK
INFO:     100.64.0.32:59398 - "GET /api/encounter/members/6472594c-f3f3-47fc-8423-8d81e1028785 HTTP/1.1" 200 OK
INFO:     100.64.0.32:51224 - "OPTIONS /api/compare HTTP/1.1" 200 OK
ERROR:utils:Error in compare_blobs: OpenCV(4.11.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:993: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'

ERROR:api:Error in face comparison: OpenCV(4.11.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:993: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'
Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 876, in compare_images
    comparison_result = await face_system.compare_blobs(profile_image_url, webcam_image)
  File "/workspace/nhis/utils.py", line 163, in compare_blobs
    webcam_image_cv = cv2.imdecode(webcam_image_np, cv2.IMREAD_COLOR)
cv2.error: OpenCV(4.11.0) /io/opencv/modules/imgcodecs/src/loadsave.cpp:993: error: (-215:Assertion failed) !buf.empty() in function 'imdecode_'

INFO:     100.64.0.32:51224 - "POST /api/compare HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.35:36914 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.35:36904 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.35:50472 - "OPTIONS /autocomplete/memberships?query=maw HTTP/1.1" 200 OK
INFO:     100.64.0.35:50472 - "GET /autocomplete/memberships?query=maw HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH002, token: a72cb0b2-b19a-49ae-89ae-515d18dee12e
INFO:     100.64.0.35:41432 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.32:37064 - "OPTIONS /api/encounter/a72cb0b2-b19a-49ae-89ae-515d18dee12e HTTP/1.1" 200 OK
INFO:     100.64.0.32:37080 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:37064 - "GET /api/encounter/a72cb0b2-b19a-49ae-89ae-515d18dee12e HTTP/1.1" 200 OK
INFO:     100.64.0.32:37064 - "OPTIONS /api/encounter/members/a72cb0b2-b19a-49ae-89ae-515d18dee12e HTTP/1.1" 200 OK
INFO:     100.64.0.32:37064 - "GET /api/encounter/members/a72cb0b2-b19a-49ae-89ae-515d18dee12e HTTP/1.1" 200 OK
INFO:     100.64.0.33:56130 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.33:56138 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.33:56130 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:56138 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.32:54140 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTkzMzN9.XK4l5VDkxc36TZBzpMxzGe09E9YFsGIpAVoK576xpo4
INFO:     100.64.0.32:54140 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.32:54140 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.32:54140 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.32:54140 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'f861e1a0-2b2b-4c37-ad2f-01f1b724252f'}
INFO:     100.64.0.32:54140 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:49324 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:49324 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.32:49328 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.32:49324 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:57602 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:57608 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:57608 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:57602 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:57602 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.26:57608 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:39734 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTkzNjl9.mc9AXk60YiFUtNCulX4Ji0jiQId6Sl2WMR7u7eM5Nmc
INFO:     100.64.0.25:39734 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.25:39740 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:39740 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.25:39740 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '1794bcaf-0d02-4851-88b2-52b69d184f14'}
INFO:     100.64.0.26:56068 - "POST /send-otp HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTkzNzZ9.ztkmkRuC06sPafffky2Qk8GGA8mrjZHY7hMzF3rVHA0
INFO:     100.64.0.33:49460 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.33:49460 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': 'f31a1ae7-7171-49d5-b890-eaa7008f1f7f'}
INFO:     100.64.0.33:49460 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.33:49462 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:38696 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.25:38696 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.25:38710 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:40446 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:40446 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.33:40458 - "POST /verify-otp HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.24:57348 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.24:57364 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTk0MTN9.W43EkN46B88Dk4XI59pSl8UTGh9Sc7xrzMZglslhOmM
INFO:     100.64.0.26:34678 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:34678 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '9814f82e-2dce-4289-9da5-35590ef92176'}
INFO:     100.64.0.26:34678 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:46720 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:46720 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:46720 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
ERROR:api:Error retrieving verification data: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/workspace/nhis/api.py", line 1010, in get_verification_by_token
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:api:Unhandled exception: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
ERROR:    Exception in ASGI application
Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
psycopg2.OperationalError: SSL SYSCALL error: EOF detected


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/protocols/http/h11_impl.py", line 403, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/applications.py", line 1054, in __call__
    await super().__call__(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/applications.py", line 112, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 187, in __call__
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/errors.py", line 165, in __call__
    await self.app(scope, receive, _send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 181, in __call__
    raise app_exc
  File "/workspace/nhis/api.py", line 97, in db_session_middleware
    response = await call_next(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 153, in call_next
    raise app_exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/base.py", line 140, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 93, in __call__
    await self.simple_response(scope, receive, send, request_headers=headers)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/cors.py", line 144, in simple_response
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/middleware/exceptions.py", line 62, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 714, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 734, in app
    await route.handle(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 288, in handle
    await self.app(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 76, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/starlette/routing.py", line 73, in app
    response = await f(request)
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/routing.py", line 291, in app
    solved_result = await solve_dependencies(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/fastapi/dependencies/utils.py", line 638, in solve_dependencies
    solved = await call(**solved_result.values)
  File "/workspace/nhis/api.py", line 179, in get_current_user
    user = db.query(User).filter(User.email == user_email).first()
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2754, in first
    return self.limit(1)._iter().first()  # type: ignore
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/query.py", line 2853, in _iter
    result: Union[ScalarResult[_T], Result[_T]] = self.session.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2365, in execute
    return self._execute_internal(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/session.py", line 2251, in _execute_internal
    result: Result[Any] = compile_state_cls.orm_execute_statement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/orm/context.py", line 305, in orm_execute_statement
    result = conn.execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1416, in execute
    return meth(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/sql/elements.py", line 516, in _execute_on_connection
    return connection._execute_clauseelement(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1638, in _execute_clauseelement
    ret = self._execute_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1843, in _execute_context
    return self._exec_single_context(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1983, in _exec_single_context
    self._handle_dbapi_exception(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 2352, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/base.py", line 1964, in _exec_single_context
    self.dialect.do_execute(
  File "/root/.local/share/virtualenvs/workspace-dqq3IVyd/lib/python3.10/site-packages/sqlalchemy/engine/default.py", line 942, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) SSL SYSCALL error: EOF detected

[SQL: SELECT users.id AS users_id, users.hospital_name AS users_hospital_name, users.email AS users_email, users.password AS users_password, users.location AS users_location, users.totp_secret AS users_totp_secret, users.backup_codes AS users_backup_codes, users.is_2fa_enabled AS users_is_2fa_enabled, users.is_email_2fa_enabled AS users_is_email_2fa_enabled 
FROM users 
WHERE users.email = %(email_1)s 
 LIMIT %(param_1)s]
[parameters: {'email_1': 'blvcksaphhire@gmail.com', 'param_1': 1}]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     100.64.0.25:37504 - "OPTIONS /autocomplete/memberships?query=n HTTP/1.1" 200 OK
INFO:     100.64.0.25:37504 - "OPTIONS /autocomplete/memberships?query=ne HTTP/1.1" 200 OK
INFO:     100.64.0.25:37518 - "OPTIONS /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.25:37518 - "GET /autocomplete/memberships?query=ned HTTP/1.1" 200 OK
INFO:     100.64.0.26:53514 - "OPTIONS /api/initiate-encounter HTTP/1.1" 200 OK
INFO:api:Verification initialized for member: GH006, token: 1da6cadd-891a-4814-8156-585e61881999
INFO:     100.64.0.26:53514 - "POST /api/initiate-encounter HTTP/1.1" 200 OK
INFO:     100.64.0.27:50422 - "OPTIONS /api/encounter/1da6cadd-891a-4814-8156-585e61881999 HTTP/1.1" 200 OK
INFO:     100.64.0.27:50428 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:50428 - "GET /api/encounter/1da6cadd-891a-4814-8156-585e61881999 HTTP/1.1" 200 OK
INFO:     100.64.0.27:50428 - "OPTIONS /api/encounter/members/1da6cadd-891a-4814-8156-585e61881999 HTTP/1.1" 200 OK
INFO:     100.64.0.27:50428 - "GET /api/encounter/members/1da6cadd-891a-4814-8156-585e61881999 HTTP/1.1" 200 OK
INFO:     100.64.0.26:48102 - "OPTIONS /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.26:48102 - "POST /api/compare HTTP/1.1" 200 OK
INFO:     100.64.0.26:38224 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdWViaXJkMjNzem5AZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTk1ODR9.vlwikmgdcuS_ZJkJm1kmxK4XM0hraxn_rJMqAaisY08
INFO:     100.64.0.26:38224 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.26:38224 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:38224 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.26:38224 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '151eadec-10f7-479d-9e6d-8a781f62f8a8'}
INFO:     100.64.0.26:38224 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:54972 - "OPTIONS /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:54972 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.27:54972 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:54974 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:54972 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:54974 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:52822 - "OPTIONS /verified_encounters?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.27:52832 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.27:52822 - "GET /verified_encounters?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.26:46932 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:49762 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.26:49762 - "GET /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTk3MjZ9.ZqP8lgqNjBDlRRlqIn7sY8oQqiM8HRL_XthYczWlDTs
INFO:     100.64.0.24:41986 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:41986 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '29d07378-11c4-4b5e-ac81-ad79d271183d'}
INFO:     100.64.0.24:41986 - "POST /send-otp HTTP/1.1" 200 OK
INFO:     100.64.0.35:45672 - "POST /verify-otp HTTP/1.1" 200 OK
INFO:     100.64.0.35:45672 - "GET /user/profile HTTP/1.1" 200 OK
ERROR:api:Error retrieving verifications: (psycopg2.errors.UndefinedTable) relation "verification_tokens" does not exist
LINE 3: FROM verification_tokens 
             ^

[SQL: SELECT count(*) AS count_1 
FROM (SELECT verification_tokens.id AS verification_tokens_id, verification_tokens.token AS verification_tokens_token, verification_tokens.membership_id AS verification_tokens_membership_id, verification_tokens.nhis_number AS verification_tokens_nhis_number, verification_tokens.first_name AS verification_tokens_first_name, verification_tokens.middle_name AS verification_tokens_middle_name, verification_tokens.last_name AS verification_tokens_last_name, verification_tokens.date_of_birth AS verification_tokens_date_of_birth, verification_tokens.profile_image_url AS verification_tokens_profile_image_url, verification_tokens.compare_image_url AS verification_tokens_compare_image_url, verification_tokens.encounter_image_url AS verification_tokens_encounter_image_url, verification_tokens.gender AS verification_tokens_gender, verification_tokens.phone_number AS verification_tokens_phone_number, verification_tokens.ghana_card_number AS verification_tokens_ghana_card_number, verification_tokens.residential_address AS verification_tokens_residential_address, verification_tokens.enrolment_status AS verification_tokens_enrolment_status, verification_tokens.verification_date AS verification_tokens_verification_date, verification_tokens.created_at AS verification_tokens_created_at, verification_tokens.verification_status AS verification_tokens_verification_status, verification_tokens.user_id AS verification_tokens_user_id, verification_tokens.current_expiry_date AS verification_tokens_current_expiry_date, verification_tokens.final_verification_status AS verification_tokens_final_verification_status, verification_tokens.disposition_name AS verification_tokens_disposition_name, verification_tokens.final_time AS verification_tokens_final_time, verification_tokens.insurance_type AS verification_tokens_insurance_type 
FROM verification_tokens 
WHERE verification_tokens.user_id = %(user_id_1)s) AS anon_1]
[parameters: {'user_id_1': 2}]
(Background on this error at: https://sqlalche.me/e/20/f405)
INFO:     100.64.0.35:45678 - "GET /my_verifications?limit=15 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.24:49940 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.24:49942 - "OPTIONS /user/profile HTTP/1.1" 200 OK
ERROR:api:Error retrieving verifications: (psycopg2.errors.UndefinedTable) relation "verification_tokens" does not exist
LINE 3: FROM verification_tokens 
             ^

[SQL: SELECT count(*) AS count_1 
FROM (SELECT verification_tokens.id AS verification_tokens_id, verification_tokens.token AS verification_tokens_token, verification_tokens.membership_id AS verification_tokens_membership_id, verification_tokens.nhis_number AS verification_tokens_nhis_number, verification_tokens.first_name AS verification_tokens_first_name, verification_tokens.middle_name AS verification_tokens_middle_name, verification_tokens.last_name AS verification_tokens_last_name, verification_tokens.date_of_birth AS verification_tokens_date_of_birth, verification_tokens.profile_image_url AS verification_tokens_profile_image_url, verification_tokens.compare_image_url AS verification_tokens_compare_image_url, verification_tokens.encounter_image_url AS verification_tokens_encounter_image_url, verification_tokens.gender AS verification_tokens_gender, verification_tokens.phone_number AS verification_tokens_phone_number, verification_tokens.ghana_card_number AS verification_tokens_ghana_card_number, verification_tokens.residential_address AS verification_tokens_residential_address, verification_tokens.enrolment_status AS verification_tokens_enrolment_status, verification_tokens.verification_date AS verification_tokens_verification_date, verification_tokens.created_at AS verification_tokens_created_at, verification_tokens.verification_status AS verification_tokens_verification_status, verification_tokens.user_id AS verification_tokens_user_id, verification_tokens.current_expiry_date AS verification_tokens_current_expiry_date, verification_tokens.final_verification_status AS verification_tokens_final_verification_status, verification_tokens.disposition_name AS verification_tokens_disposition_name, verification_tokens.final_time AS verification_tokens_final_time, verification_tokens.insurance_type AS verification_tokens_insurance_type 
FROM verification_tokens 
WHERE verification_tokens.user_id = %(user_id_1)s) AS anon_1]
[parameters: {'user_id_1': 2}]
(Background on this error at: https://sqlalche.me/e/20/f405)
INFO:     100.64.0.24:49940 - "GET /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.24:49942 - "GET /my_verifications?limit=15 HTTP/1.1" 500 Internal Server Error
INFO:     100.64.0.35:54406 - "OPTIONS /my_verifications?limit=15 HTTP/1.1" 200 OK
INFO:     100.64.0.35:54416 - "OPTIONS /user/profile HTTP/1.1" 200 OK
INFO:     100.64.0.35:54406 - "GET /my_verifications?limit=15 HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.35:54416 - "GET /user/profile HTTP/1.1" 401 Unauthorized
INFO:     100.64.0.24:50756 - "OPTIONS /login HTTP/1.1" 200 OK
INFO:api:Generated short-lived token for 2FA: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6ImJsdmNrc2FwaGhpcmVAZ21haWwuY29tIiwiaXNfMmZhIjp0cnVlLCJleHAiOjE3NDIzOTk3OTJ9.M9lxDCQUtY09rXBTIVxccXsNAOVfKg6p0RXlWJik1hw
INFO:     100.64.0.24:50756 - "POST /login HTTP/1.1" 200 OK
INFO:     100.64.0.24:50756 - "OPTIONS /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.24:50756 - "GET /check-mfa HTTP/1.1" 200 OK
INFO:     100.64.0.24:50756 - "OPTIONS /send-otp HTTP/1.1" 200 OK
INFO:sendd:Email sent successfully: {'id': '5c55f2a5-e37e-4c92-b436-fc536183edcf'}
INFO:     100.64.0.24:50756 - "POST /send-otp HTTP/1.1" 200 OK
